## 大文件上传的业务背景和挑战

大文件上传是许多在线应用和服务中的一个常见需求，尤其是在那些需要处理视频、音频、大型文档集或高分辨率图片的场景中。这项功能的业务背景和挑战可以从多个角度来看:

### 业务背景

1. **媒体处理**: 视频编辑平台、音频处理软件、图像库等需要上传大量媒体文件。
2. **数据备份与迁移**: 企业需要备份或迁移大量数据，包括数据库文件、系统镜像等。
3. **内容分发网络**: 在CDN中上传大文件以便更快地在全球范围内分发。
4. **科学与研究**: 上传大型数据集，例如基因组序列、气象模型数据等。
5. **教育和在线学习**: 上传高质量的教学视频和教材。
6. **法律和财务**: 共享大量的法律文档或财务报表。

### 面临挑战

1. **性能问题**: 大文件上传可能导致客户端(浏览器)性能下降，特别是在资源有限的设备上。
2. **网络不稳定**: 大文件更有可能在上传过程中遇到网络问题，如断线、超时等
3. **服务器负载**: 大文件上传会给服务器带来更大的负载，特别是在处理大量此类请求时。
4. **用户体验**: 长时间的上传过程可能导致用户感到不耐烦，影响用户体验。
5. **文件完整性和安全性**: 确保文件在传输过程中不被破坏或篡改，同时保证数据的隐私和安全
6. **断点续传**: 支持在网络中断后能够继续上传，而不是重新开始。
7. **数据处理**: 大文件需要更复杂的处理流程，例如切片、压缩和解压缩。
8. **兼容性和标准化**: 确保各种浏览器和设备都能顺利完成上传过程。

### 难点扩展

1. 文件加密
2. 传输加密
3. 压缩处理

## 异常报错处理

### Cannot read properties of undefined (reading 'digest')

遇到 `crypto.subtle.digest` 报错 `Cannot read properties of undefined (reading 'digest')` 通常意味着 `window.crypto.subtle` 是 `undefined`，这可能是因为以下几个原因：

- 你的网页可能没有在安全上下文中运行。SubtleCrypto 接口的 digest() 方法仅在支持的浏览器的安全上下文（HTTPS）中可用。如果你在本地测试，确保你的网址是 https://localhost:PORT 而不是 http://localhost:PORT 或 0.0.0.0:port。
- 某些浏览器或浏览器的特定版本可能在非安全上下文中禁用了 crypto.subtle。例如，Chrome 60 版本开始在非 TLS 连接中禁用 crypto.subtle。
- 如果你的代码在 https://blank.org 能够正常工作，而在其他网站不行，可能是因为其他网站使用了某些特性或配置，导致 crypto.subtle 不可用。

解决方案可能包括：

- 确保你的网页是通过 HTTPS 服务的。
- 如果你在本地开发，尝试使用正确的 `localhost` 地址格式。
- 检查浏览器的兼容性和版本，确保它支持 `SubtleCrypto` 接口。 

如果问题仍然存在，你可能需要检查浏览器的控制台以获取更多错误信息，或者查看浏览器的文档来了解如何启用或调试 `crypto.subtle`。

---


